// TI calculator simulator
// Ken Shirriff, http://righto.com/ti
// Based on patent US3934233
// Code transcribed by Phil Mainwaring
//
// This file holds the source and object code to be executed.

var sourceCode = [
  '0   START    ZFA    ALL ; init - clear flags',
  '1            ZFB    ALL',
  '2            AKA    ALL; clear A and C',
  '3            AKC    ALL',
  '4   MAINLOOP SLLA   MASK4',
  '5            AKB    ALL; clear B',
  '6   WAITSCAN SYNC   ',
  '7            SCAN   ',
  '8            BINE   WAITSCAN',
  '9   WAITKEY  WAITNO WAITED',
  '10  WAITED2  SYNC   ',
  '11           SCAN   ',
  '12           BIE    WAITKEY ; loop if no key',
  '13           SYNC   ',
  '14           SRLA   MASK4',
  '15           BKO    LOWERKEY',
  '16           BKO    PLUSKEY',
  '17           BKO    MINUSKEY',
  '18           BKO    DIVKEY',
  '19           BKO    MULTKEY',
  '20           BKO    UPPERKEY',
  '21           BKO    EKEY',
  '22           BKO    ZEROKEY',
  '23           EXAB   ALL ; save A in B, A=0',
  '24           AKCN   MASK3 ; count column into A',
  '25           EXAB   ALL ; restore A, B holds count',
  '26           BINE   MAINLOOP ; loop if no key down',
  '27  ZEROKEY  TFB    EMODE ; B holds key 0-9',
  '28           BINE   EDIGIT',
  '29           TFB    FLAG6B ; if FLAG6B...',
  '30           BIE    LABEL33',
  '31           AKA    ALL ; then clear A and FLAG6B',
  '32           ZFB    FLAG6B',
  '33  LABEL33  ACKA   MASK15 ; C holds digit position',
  '34  BSHIFT   SRLB   ALL ; shift B right C times.',
  '35           SAKA   MASK3 ; decrement A',
  '36           BIE    BSHIFT (no borrow)',
  '37           ACKC   MASK3 ; increment C',
  '38           AABA   MASK4 ; Append new digit',
  '39           BIE    MAINLOOP ; done digit processing',
  '40  EDIGIT   ZFB    NEWEXP ; clear new exponent flag',
  '41           SLLA   MASK2 ; shift exponent left',
  '42           SLLB   ALL ; shift digit left',
  '43           AABA   MASK2 ; append new digit to exponent',
  '44           BIE    MAINLOOP ; done',
  '45  EKEY     SFB    EMODE ; entering exponent mode',
  '46           SFB    NEWEXP',
  '47           BIE    MAINLOOP ; done',
  '48  LOWERKEY SFA    LOW ; LOW and UP_LOW set for LOWER key',
  '49  UPPERKEY SFA    UP_LOW ; UP_LOW set for UPPER key',
  '50           BIE    MAINLOOP ; done',
  '51  MINUSKEY TFA    UP_LOW ; alt-MINUS is COS',
  '52           BINE   COSKEY',
  '53           TFB    NEWEXP ; - follows E?',
  '54           BIE    DOMINUS',
  '55           AAKA   MASK7 ; if so, set minus flag',
  '56           BIE    MAINLOOP',
  '57  DOMINUS  AAKA   MASK1 ; set minus flag',
  '58           BIE    PLUSKEY ; clear condition flag?',
  '59  PLUSKEY  TFA    UP_LOW ; alt-PLUS is SIN',
  '60           BINE   SINKEY',
  '61  LABEL61  AKC    MASK15 ; perform addition/subtraction',
  '62           ACKB   ALL',
  '63           ABAC   MASK2',
  '64           BIE    LABEL65',
  '65  LABEL65  ABAC   MASK7',
  '66           SCKC   MASK7',
  '67           BIE    LABEL72',
  '68           CAB    MASK2',
  '69           BIE    LABEL71',
  '70           EXAB   ALL',
  '71  LABEL71  SABC   MASK2',
  '72  LABEL72  CAK    MASK7',
  '73           BINE   LABEL75',
  '74           EXAB   ALL',
  '75  LABEL75  CAK    MASK10',
  '76           BIE    BSHIFT2',
  '77           EXAB   ALL',
  '78  BSHIFT2  SCKC   MASK6 ; loop to shift B right C times',
  '79           BINE   DONE2',
  '80           SRLB   MASK4',
  '81           BIE    BSHIFT2',
  '82  DONE2    ABAC   MASK1',
  '83           SCKC   MASK1',
  '84           BIE    LABEL89',
  '85  EXLOOP   AABA   MASK4 ; loop for some sort of exchange',
  '86           BIE    WRAPUP',
  '87           EXAB   MASK4',
  '88           EXAB   MASK1',
  '89  LABEL89  SABA   MASK4',
  '90           BINE   EXLOOP',
  '91           BIE    WRAPUP ; BET',
  '92  LABEL92  CAB    MASK2',
  '93           BIE    LABEL95',
  '94           EXAB   MASK9',
  '95  LABEL95  SABA   MASK2',
  '96           BIE    LABEL114 ; BET - no borrow?',
  '97  DIVKEY   TFA    UP_LOW ; entry point for DIV',
  '98           BINE   TANKEY ; alt-DIV is TAN',
  '99           SFA    COS_TAN ; why set COS? Doesn\'t make sense',
  '100 LABEL100 SFA    RET1FLAG ; "subroutine call" flag',
  '101          BIE    WRAPUP ; BET',
  '102 RET1     ZFA    RET1FLAG ; RET1FLAG means return here',
  '103          AAKA   MASK7',
  '104          BIE    MULTKEY ; why? need to clear flag before TFA?',
  '105 MULTKEY  TFA    UP_LOW ; alt-MULT is LOG',
  '106          BINE   LOGKEY',
  '107          AKC    MASK15',
  '108          ACKB   ALL',
  '109          EXAB   MASK4',
  '110          ABAC   MASK7',
  '111          SCKC   MASK7',
  '112          BIE    LABEL92',
  '113          AABA   MASK2',
  '114 LABEL114 AABA   MASK1',
  '115          BIE    LABEL116 ; clear before test',
  '116 LABEL116 TFA    COS_TAN',
  '117 LABEL117 AKA    MASK4',
  '118          BINE   LABEL279 ; branch if COS or TAN',
  '119 LABEL119 SRLA   MASK4',
  '120 LABEL120 CCK    MASK5',
  '121          BINE   LABEL125',
  '122          SCKC   MASK10',
  '123          AABA   MASK4',
  '124          BIE    LABEL120',
  '125 LABEL125 SRLC   MASK4',
  '126          CCK    MASK10',
  '127          BIE    LABEL119',
  '128          TFA    LOW',
  '129          BINE   LABEL308',
  '130 WRAPUP   CAK    MASK10 ; check against MASK10 for done',
  '131          BINE   START ; reset everything',
  '132 WLOOP    CAK    MASK3',
  '133          BIE    LABEL145',
  '134          SLLA   MASK4',
  '135          CAK    MASK7',
  '136          BIE    LABEL142',
  '137          SAKA   MASK6',
  '138          BIE    LABEL141',
  '139          AKA    MASK7',
  '140          AKA    MASK6',
  '141 LABEL141 SAKA   MASK6',
  '142 LABEL142 AAKA   MASK6',
  '143          BIE    WLOOP ; first will clear flag?',
  '144          BIE    WLOOP ; second will always happen',
  '145 LABEL145 SRLA   MASK4',
  '146          CAK    MASK7',
  '147          BINE   LABEL150',
  '148          SAKA   MASK6',
  '149          SAKA   MASK6',
  '150 LABEL150 AAKA   MASK6',
  '151          BIE    LABEL152 ; clear before test?',
  '152 LABEL152 TFA    RET1FLAG',
  '153          BINE   RET1 ; return to RET1 if RET1FLAG set',
  '154          ZFB    ALL',
  '155          SFB    FLAG6B',
  '156          ZFA    ALL',
  '157          CAK    MASK6',
  '158          BIE    LABEL161',
  '159 LABEL159 AAKA   MASK7',
  '160          BIE    LABEL159',
  '161 LABEL161 AAKC   ALL',
  '162          BIE    MAINLOOP ; BET maybe?',
  '163 TANKEY   SFA    TAN',
  '164 COSKEY   SFA    COS_TAN',
  '165 SINKEY   SAKA   MASK6 ; loop and shift A right',
  '166          BINE   DONESHFT',
  '167          SRLA   MASK4',
  '168          BIE    SINKEY',
  '169 DONESHFT AKA    MASK9',
  '170          SAKA   MASK9',
  '171          AKC    ALL',
  '172          TFA    LOW',
  '173          BIE    LABEL180',
  '174          TFA    TAN',
  '175          BIE    LABEL179',
  '176          AAKC   ALL',
  '177          AKB    MASK11',
  '178          BIE    TRGLOOP2',
  '179 LABEL179 AAKA   MASK13',
  '180 LABEL180 AKB    MASK12',
  '181          SRLB   MASK4',
  '182          ACKC   MASK11',
  '183 TRIGLOOP SAKA   MASK13',
  '184          BINE   LABEL226',
  '185 TRGLOOP2 SLLC   ALL ; shift C left 3',
  '186          SLLC   ALL',
  '187          SLLC   ALL',
  '188          ACKC   MASK12 ; C+K -> C',
  '189          SCBC   ALL ; C-B -> C',
  '190          SRLC   ALL ; shift C right 3',
  '191          SRLC   ALL',
  '192          SRLC   ALL',
  '193          SLLB   ALL ; shift B left 3',
  '194          SLLB   ALL',
  '195          SLLB   ALL',
  '196          ACKC   MASK12 ; C+K -> C',
  '197          ABCA   ALL ; B+C -> A',
  '198          SCKC   MASK12 ; C-K -> C - why add then subtract?',
  '199          SRLB   ALL ; shift B right 3',
  '200          SRLB   ALL',
  '201          SRLB   ALL',
  '202          TFA    LOW ; ARC-op?',
  '203          BIE    TRIGLOOP ; no: branch',
  '204          AAKA   MASK9 ; ARC-op',
  '205          TFA    TAN',
  '206          BIE    ISSINCOS ; branch if SIN/COS',
  '207          CCK    MASK3 ; doing TAN, compare C to K',
  '208          BINE   TRGLOOP2 ; loop if not done',
  '209          BIE    TRIG2 ; BET',
  '210 ISSINCOS TFA    COS_TAN ; SIN/COS',
  '211          BINE   ISCOS ; branch if COS',
  '212          CAB    MASK4 ; must be SIN',
  '213          BIE    TRGLOOP2',
  '214          BIE    TRIG2',
  '215 ISCOS    CAK    MASK10 ; COS',
  '216          EXAB   MASK4 ; compare C-A the hard way',
  '217          CCB    MASK4',
  '218          EXAB   MASK4',
  '219          BIE    TRGLOOP2 ; C==A',
  '220 TRIG2    SRLA   ALL ; shift A right 5',
  '221          SRLA   ALL',
  '222          SRLA   ALL',
  '223          SRLA   ALL',
  '224          SRLA   ALL',
  '225          BIE    WRAPUP ; done if A zero',
  '226 LABEL226 TFA    TAN',
  '227          BIE    LABEL233',
  '228          ACKA   ALL ; doing TAN',
  '229          ABOC   ALL',
  '230          AKB    ALL',
  '231          ZFA    UP_LOW',
  '232          BIE    LABEL100 ; do division??? what is condition here?',
  '233 LABEL233 TFA    COS_TAN ',
  '234          BIE    LABEL236 ; branch for SIN',
  '235          ACKB   ALL ; COS',
  '236 LABEL236 EXAB   ALL ; SIN',
  '237          BIE    WRAPUP ; BET (no overflow)',
  '238 LOGKEY   TFA    LOW ; low-MULT is antilog',
  '239          BIE    LOG    ',
  '240 ANTILOG  CAK    MASK6 ; antilog - loop',
  '241          BINE   LABEL248',
  '242          CAK    MASK7',
  '243          BINE   LABEL247',
  '244          SRLA   MASK4',
  '245          SAKA   MASK6',
  '246          BIE    ANTILOG',
  '247 LABEL247 SLLA   MASK4',
  '248 LABEL248 AKA    MASK2',
  '249          SLLA   MASK8',
  '250          SLLA   MASK8',
  '251 LOG      AKC    ALL',
  '252          ACKC   MASK3',
  '253 LOGLOOP ACKB   MASK4',
  '254          SRLB   MASK4',
  '255          SRLB   MASK4',
  '256          SCBC   MASK4',
  '257          TFB    NEWEXP',
  '258          BINE   LABEL311',
  '259          ACKC   MASK9',
  '260          CCK    MASK11',
  '261          BIE    LOGLOOP',
  '262          SCBB   MASK9',
  '263          ABCC   MASK4',
  '264          SCKC   MASK11',
  '265          SRLB   ALL',
  '266          SRLB   ALL',
  '267          SRLB   ALL',
  '268          SRLB   ALL',
  '269          ABCA   MASK4',
  '270          EXAB   MASK4',
  '271          TFA    LOW',
  '272          BINE   LABEL302',
  '273          ABOC   ALL',
  '274          FFA    TAN',
  '275          TFA    TAN',
  '276          BINE   LOGLOOP',
  '277          AAKC   MASK4',
  '278 LABEL278 AKA    MASK4',
  '279 LABEL279 AKA    MASK14 ; COS or TAN',
  '280 LOGLOOP2 CCB    MASK4',
  '281          BINE   LABEL285',
  '282          SCBC   MASK4',
  '283          AAKA   MASK10',
  '284          BIE    LOGLOOP2',
  '285 LABEL285 AAKC   MASK3',
  '286          BINE   LABEL291',
  '287          SLLA   MASK4',
  '288          ACKA   MASK15',
  '289          SLLC   MASK4',
  '290          BIE    LOGLOOP2',
  '291 LABEL291 AKA    MASK15',
  '292          TFA    UP_LOW',
  '293          BINE   LOGSKIP',
  '294          BIE    WRAPUP',
  '295 WAITED   BIE    WAITED2 ; inconvenient WAITNO target',
  '296 LOGSKIP  AAKC   MASK4',
  '297          AKA    MASK4',
  '298          SRLA   ALL',
  '299          SRLA   ALL',
  '300          AKA    MASK2',
  '301          BIE    LABEL61',
  '302 LABEL302 AAKC   MASK4',
  '303          AKA    MASK4',
  '304          AKA    MASK11',
  '305          SABA   MASK4',
  '306          EXAB   MASK4',
  '307          BIE    LABEL117',
  '308 LABEL308 SRLA   MASK4',
  '309          SFB    NEWEXP',
  '310          BIE    LOG    ',
  '311 LABEL311 SAKA   MASK13',
  '312          BIE    LOGLOOP',
  '313          AAKA   MASK13',
  '314          SLLA   MASK4',
  '315          AAKA   MASK11',
  '316          ABCC   MASK4',
  '317          EXAB   MASK4',
  '318          ZFA    UP_LOW',
  '319          BINE   LABEL278 ; isn\'t flag zero after ZFA?? Maybe still NE from ABCC?',
];
var objectCode = [
1408,1392,1792,1824,1860,1808,1360,1376,
518,1319,1360,1376,9,1360,1908,1072,
1083,1075,1121,1129,1073,1069,1051,1840,
1955,1840,516,1425,552,1430,33,1792,
1398,1631,1920,1683,34,2003,1540,4,
1399,1858,1872,1538,4,1329,1335,4,
1349,1347,4,1443,676,1431,57,1559,
4,1553,59,1443,677,1839,1632,2018,
65,2023,1719,72,1730,71,1840,1666,
1751,587,1840,1754,78,1840,1718,594,
1924,78,2017,1713,89,1540,130,1844,
1841,1652,597,130,1730,95,1849,1650,
114,1443,675,1355,1345,130,1409,1559,
105,1443,750,1839,1632,1844,2023,1719,
92,1538,1537,116,1451,1796,791,1908,
1781,637,1722,1540,120,1940,1786,119,
1445,820,1754,512,1747,145,1860,1751,
142,1686,141,1799,1798,1686,1558,132,
132,1908,1751,662,1686,1686,1558,152,
1441,614,1392,1334,1408,1750,161,1559,
159,1568,4,1351,1355,1686,681,1908,
165,1801,1689,1824,1445,180,1447,179,
1568,1819,185,1565,1820,1924,2011,1693,
738,1888,1888,1888,2012,1696,1936,1936,
1936,1872,1872,1872,2012,1584,1724,1920,
1920,1920,1445,183,1561,1447,210,1779,
697,220,1451,727,1732,185,220,1754,
1844,1764,1844,185,1904,1904,1904,1904,
1904,130,1447,233,1616,1600,1808,1411,
100,1451,236,1632,1840,130,1445,251,
1750,760,1751,759,1908,1686,240,1860,
1794,1864,1864,1824,2003,1636,1924,1924,
1700,1431,823,2009,1787,253,1993,2036,
1723,1920,1920,1920,1920,1588,1844,1445,
814,1600,1479,1447,765,1572,1796,1806,
1764,797,1700,1562,280,1571,803,1860,
1631,1892,280,1807,1443,808,130,10,
1572,1796,1904,1904,1794,61,1572,1796,
1803,1652,1844,117,1908,1335,251,1693,
253,1565,1860,1563,2036,1844,1411,790,
];
